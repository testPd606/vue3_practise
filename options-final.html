<!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>章節作業練習</title>
      <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body class="bg-lighter">
      <div class="container main my-5">
        <div class="row">
          <main class="col post">
            <div class="mb-4">
              <h1 class="mt-0 text-muted">章節挑戰</h1>
            </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
            <div id="app" class="mt-2">
              <div class="row h-100">
                <div class="col-md-3 h-100 d-flex flex-column">
                  <!-- 搜尋功能 -->
                  <div class="form-floating mb-2">
                    <input type="text" class="form-control" id="search" placeholder="search" v-model="cacheSearch">
                    <label for="search">search</label>
                  </div>
                  <!-- 搜尋功能 -->
                  <!-- 左側選單 -->
                  <div class="list-group option">
                    <label class="list-group-item" v-for="(item, i) in filterSearch" :key="'keys' + i">
                      <input class="form-check-input me-1" type="radio" name="area"
                      @click="cacheArea = item" :value="keys" :checked="cacheArea.Name === item.Name">
                      {{i+1}}.{{ item.Name }}
                    </label>
                  </div>
                  <!-- 左側選單 -->
                </div>                
                <div class="col-md-8 h-100 d-flex flex-column">
                  <!-- 瀏覽紀錄 -->
                  <div class="form-floating">
                    <select id="cacheArea" class="form-select w-50 mb-2" aria-label="select example" v-model="cacheArea">
                      <option selected value="" disabled>瀏覽紀錄</option>
                      <option :value="item" v-for="(item, i) in browseLog" :key="item.Name">{{i+1}}.{{item.Name}}</option>
                    </select>
                    <label for="cacheArea">瀏覽紀錄</label>
                  </div>
                  <!-- 瀏覽紀錄 -->
                  <!-- 顯示區域 -->
                    <div class="card overflow-auto">
                      <div v-if="cacheArea">
                        <img :src="cacheArea.Picture1" class="card-img-top" :alt="cacheArea.Name">
                        <iframe width="100%" height="300" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
                                :src=`https://maps.google.com.tw/maps?f=q&hl=zh-TW&geocode=&q=${cacheArea.Py},${cacheArea.Px}(${cacheArea.Name})&z=16&output=embed`></iframe>
                        <div class="card-body">
                          <h5 class="card-title">{{ cacheArea.Name }}</h5>
                          <p>{{ cacheArea.Description }}</p>
                        </div>
                      </div>
                      <div v-else class="card-body">
                        請選擇場域
                      </div>
                    </div>
                  <!-- 顯示區域 -->
                </div>
              </div>
            </div>
            
            <script>
            const App = {
              data() {
                return {
                  datastore: [],// 儲存遠端資料
                  cacheArea: '',// 暫時儲存使用者使用過的資料
                  cacheSearch: '',// 儲存使用者輸入的關鍵字
                  browseLog: [],// 儲存使用者瀏覽過的紀錄
                };
              },
              methods:{
                getDate(){
                  // 將遠端json資料賦予給變數apiUrl
                  const apiUrl = 'https://raw.githubusercontent.com/hexschool/KCGTravel/master/datastore_search.json';
                  axios.get(apiUrl).then((res) => {
                    // 取出變數apiUrl內的遠端部屬資料
                    this.datastore = res.data.result.records;
                    // 將遠端部屬資料賦予給陣列datastore
                  })
                },
              },
              created(){
                this.getDate();
                // 執行遠端資料賦予的動作
              },
              computed:{
                filterSearch(){
                  return this.datastore.filter((item)=>{
                    return item.Name.match(this.cacheSearch)
                  });
                },
              },
              watch:{
                //監聽cacheArea
                cacheArea(){
                  if(this.browseLog.length < 10){
                    this.browseLog.push(this.cacheArea);
                  } else {
                    this.browseLog.shift();
                    this.browseLog.push(this.cacheArea);
                  };
                },
              },
            };
            
            Vue.createApp(App).mount('#app');
            </script>
            
            <style>
                #app {
                    height: 600px;
                }
            
                .option {
                    overflow-y: auto;
                }
            </style>
          </main>                  
        </div>
      </div>
    </body>
  </html>